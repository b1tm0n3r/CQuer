@model TicketsViewModel
@using Common.DataModels.IdentityManagement
@using CQuerMVC.Helpers

<div class="box">
    <div class="justify-content-center align-items-center">
        <div class="mb-3 mt-3">
            <a asp-action="Create" class="btn btn-primary">Create</a>
        </div>

        <table class="table table-striped table-bordered table-dark">
            <tr>
                <th>CreatorId</th>
                <th>Descrption</th>
                <th>Severity</th>
                <th>Solved</th>
                <th>DownloadUrl</th>
                <th>Sha256Checksum</th>
                <th>Operations</th>
            </tr>
            @foreach (var item in Model.Tickets)
            {
                <tr>
                    <td>@item.Username</td>
                    <td>@item.Description</td>
                    <td>@item.Severity</td>
                    <td>@item.Solved.ToYesNoString()</td>
                    <td>@item.DownloadUrl</td>
                    <td>@item.Sha256Checksum</td>
                    
                    <td>
                        <a asp-action="Delete" asp-route-id="@item.Id">Delete</a>
                        @if (!@item.Solved)
                        {
                            <a asp-action="Update" asp-route-id="@item.Id">Edit</a>
                            @if (User.IsInRole(AccountType.Administrator.ToString()))
                            {
                                <form asp-controller="Files" asp-action="Resolver">
                                    <input name="TicketId" type="hidden" asp-for="@item.Id" />
                                    <input name="DownloadUrl" type="hidden" asp-for="@item.DownloadUrl" />
                                    <input name="Sha256Checksum" type="hidden" asp-for="@item.Sha256Checksum" />
                                    <button>Resolve</button>
                                </form>
                            }
                        }
                    </td>
                </tr>
            }
        </table>
    </div>
</div>

